# <center>**正反向代理和负载均衡**</center>

<article align="left" padding="0 12px">

**正向代理（forward proxy）：** <font color='red'>代理服务器代理了客户端</font>，去和目标服务器进行交互。

**正向代理的用途：**
- 突破 IP 访问限制 vpn(翻墙，在家访问公司内网)，记录用户访问记录（上网行为管理）
- 通过缓存加速访问资源cdn
- 隐藏客户端真实 IP
- 对客户端访问授权，上网进行认证 (常用软件： CCProxy，只让部分IP可以上外网，对外隐藏用户信息)

**反向代理（Reverse Proxy）：** <font color='red'>代理服务器代理了目标服务器</font>，去和客户端进行交互。

**反向代理的用途：**
- 隐藏服务器真实 IP
- 负载均衡
- 通过缓存加速访问资源
- 保证内网的安全(使用反向代理提供web应用防火墙功能，阻止web攻击)

**负载均衡（Load Balance）：** 由多台服务器以对称的方式组成一个服务器集群，每台服务器都具有等价的地位，都可以单独对外提供服务而无须其他服务器的辅助。经过某种负载分管技术，将外部发送来的中央请求均匀分配到对称结构中的某一台服务器上。

**负载均衡的用途：**
开发好的某个应用部署在一台 Tomcat 服务器上，而 Tomcat 的并发上限不优化情况下，默认只有两百左右，这时候为了解决高并发的问题，就只能选择更替服务器或者搭建多台服务器通过反向代理与负载均衡的技术解决并发问题。

**Nginx常用的几种负载均衡方式:**
- 轮询（默认）
每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。
- weight
指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。
```
upstream bakend {
server 192.168.0.14 weight=10;
server 192.168.0.15 weight=10;
}
```
- ip_hash
每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。
```
upstream bakend {
ip_hash;
server 192.168.0.14:88;
server 192.168.0.15:80;
}
```
- fair（第三方）
按后端服务器的响应时间来分配请求，响应时间短的优先分配。
```
upstream backend {
server server1;
server server2;
fair;
}
```
- url_hash（第三方）
按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。举例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法
```
upstream backend {
server squid1:3128;
server squid2:3129;

hash $request_uri;
hash_method crc32;
}
```
</article>